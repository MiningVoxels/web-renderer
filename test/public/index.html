<!DOCTYPE html>
<html lang="en">
<head>
    <title>WharfKit/Web - UI Test</title>
    <script src="./bundle.js"></script>
    <script>
        const {SessionKit, WalletPluginPrivateKey} = WharfKitWeb
        const sessionKit = new SessionKit({
            appName: 'demo-app',
            chains: [{
                id: '73e4385a2708e6d7048834fbc1079f2fabb17b3c125b146af438971e90716c4d',
                url: 'https://jungle4.greymass.com'
            }],
            ui: new WharfKitWeb(),
            walletPlugins: [new WalletPluginPrivateKey({
                privateKey: '5Jtoxgny5tT7NiNFp1MLogviuPJ9NniWjnU4wKzaX4t7pL4kJ8s'
            })]
        })

        // the session instance, either restored using link.restoreSession() or created with link.login()
        let session

        // tries to restore session, called when document is loaded
        function restoreSession() {
            console.log('restoreSession (NYI)')
            // link.restoreSession(identifier).then((result) => {
            //     session = result
            //     if (session) {
            //         didLogin()
            //     }
            // })
        }

        // login and store session if sucessful
        function login() {
            console.log('login')
            sessionKit.login({permissionLevel: 'wharfkittest@test'}).then((result) => {
                console.log('successful', result)
                session = result
                didLogin()
            })
        }

        // logout and remove session from storage
        function logout() {
            console.log('logout')
            document.body.classList.remove('logged-in')
            session = undefined
        }

        // called when session was restored or created
        function didLogin() {
            console.log('didLogin')
            document.getElementById('account-name').textContent = session.actor
            document.body.classList.add('logged-in')
        }

        // transfer tokens using a session
        function transfer() {
            console.log('transfer')
            const action = {
                account: 'eosio.token',
                name: 'transfer',
                authorization: [session.permissionLevel],
                data: {
                    from: session.actor,
                    to: 'teamgreymass',
                    quantity: '0.0001 EOS',
                    memo: 'Yay WharfKit! Thank you <3'
                }
            }
            session.transact({action}, {broadcast: false}).then((result) => {
                console.log(result)
                document.getElementById('log').innerHTML += `Transaction broadcast! ${ result.resolved.transaction.id }\n`
            })
        }
    </script>
    <style>
        .logged-in #login-ui {
            display: none;
        }
        #app-ui {
            display: none;
        }
        .logged-in #app-ui {
            display: block;
        }
    </style>
</head>
<body onload="restoreSession()">
    <div id="app-ui">
        <p>Welcome <b id="account-name">foo</b>!</p>
        <ul>
            <li><button onclick="transfer()">Test transfer</button></li>
            <li><button onclick="logout()">Log out</button></li>
        </ul>
        <pre id="log"></pre>
    </div>
    <div id="login-ui">
        <button onclick="login()">Login</button>
    </div>
</body>
</html>
